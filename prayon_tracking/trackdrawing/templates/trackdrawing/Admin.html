{% extends 'trackdrawing/PageTemplate.html' %}
{% load render_table from django_tables2 %}
{% block mainframe %}

<div>
	<form action="{% url 'GroupUser' %}" method="post">{% csrf_token %}
		<table class="table">
			<thead>
				<tr>
					<th>Users</th>
					<th>Groups</th>
				</tr>
			</thead>
			<tbody id="data">
				{% for usrs in users %}
					<tr>
						<td>{{usrs.0}}</td>
						<td>
						{% for grp in groups %}
							<label for="{{grp}}">{{grp}}</label>
							{% if grp in usrs.1 %}
								<input type="radio" onclick="checkbox(this)" name="{{grp|add:'_'|add:usrs.0}}">	
							{% else %}
								<input type="radio" onclick="checkbox(this)"  name="{{grp|add:'_'|add:usrs.0}}">	
							{% endif %}
						{% endfor%}
						</td>
					</tr>
				{% endfor%}
			</tbody>
		</table>
	    <input type="submit" class="btn btn-primary" value="Valider">
	</form>
</div>

<script type="text/javascript">
	var user = {{ users|safe}};
	var grp = {{groups|safe}};
	var Disabled = false
	$(document).ready(function(e){
		$("#data").find("input").each(function(e){
			var data = $(this)[0].name.split("_");
		
			if(data[0] == 'CP'){
				$(this)[0].disabled=true
			}
			for (item in user) {
				if(user[item][0] == data[1]){
					if(user[item][1][0] == data[0]) {
						$(this)[0].checked=true
						
					}
				}
			}
		})
	})
	function checkbox(e) {
	
			
			$(e.parentNode).find("input").each(function(f){
				if (this != e) {
					if($(this)[0].name.split('_')[0]=='CP' && $(this)[0].checked){
						$("#data").find("input").each(function(e){
							var data = $(this)[0].name.split("_");
							console.log(data)
							if(data[0] == 'CP'){
								$(this)[0].disabled=false
							}
						})
					}

					$(this)[0].checked=false

				} else {
					$(this)[0].checked=true
					if($(this)[0].name.split('_')[0]=='CP'){
						$("#data").find("input").each(function(e){
							var data = $(this)[0].name.split("_");
							if(data[0] == 'CP'){
								$(this)[0].disabled=true
							}
						})
					}
				}
					
				
			})
			
		} 
		
	
</script>

{% endblock %}